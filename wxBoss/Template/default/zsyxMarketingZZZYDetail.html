<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
	<title>&nbsp;泉州广电网络掌上营销平台</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name = "format-detection" content = "telephone=no">

	<!--标准mui.css-->
	<link rel="stylesheet" href="[!CSS]/zsyx/mui.min.css?v={$version}">
	<!--App自定义的css-->
	<link rel="stylesheet" type="text/css" href="[!CSS]/zsyx/app.css?v={$version}"/>
	<link href="[!CSS]zsyx/agentCSS/layer.css" type="text/css" rel="styleSheet" >
	<style>
	
		#marketingDetailTable table
		{
			border: 1px solid blue;
			table-layout:fixed;
			white-space: nowrap;
			font-size:10px;
		}
		
		#marketingDetailTable th
		{
			border: 1px solid #6e6e79;
			table-layout:fixed;
			white-space: nowrap;
			color:white;
			background-color:#3385ff;
			text-align:center;
			padding:0 5px;
		}
		
		#marketingDetailTable td
		{
			border: 1px solid #6e6e79;
			table-layout:fixed;
			white-space: nowrap;
			color:rgba(35, 32, 32, 0.65);
			background-color:#fafcff;
			text-align:center;
			padding:0 5px;
		}
		
	</style>
   <?
	set_time_limit(0);
	?>
		
   
  </head>
  <body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">增值在用信息表</h1>
		</header>
		<div class="mui-content">
			<div class="mui-card">
				
			
			
				<table id="condSel" style="width: 90%;font-size:10px;;margin: 5px 5%;">
					
				
					<tr  style="border-bottom: 1px solid #dcd9d9;">
						<td style="padding: 0px 10px;">
								套餐
						</td>
						
						<td>
							<span class="mui-input-row mui-radio mui-left">
								<label>全部</label>
								<input name="radioOffer" value="0" type="radio" checked >
							</span>
						</td>
						
						<td>
							<span class="mui-input-row mui-radio mui-left">
								<label>高清</label>
								<input name="radioOffer" value="1" type="radio" >
							</span>
						</td>
						
						<td>
							<span class="mui-input-row mui-radio mui-left">
								<label>互动</label>
								<input name="radioOffer" value="2" type="radio" >
							</span>
						</td>
						
						<td>
							<span class="mui-input-row mui-radio mui-left">
								<label>宽带</label>
								<input name="radioOffer" value="3" type="radio" >
							</span>
						</td>
					</tr>
					
					<tr  style="border-bottom: 1px solid #dcd9d9;">
						<td style="padding: 0px 10px;">
								发展人
						</td>
						
						<td >
							<select  id ="selectList" class="mui-btn mui-btn-block" style="color: blue;">
								<option value="0">全部</option>							
							</select>
						</td>
						<td></td>
						<td></td>
						<td style="padding: 0px 10px;">
							<button id="doSearch">查询</button>
						</td>
					</tr>
					
					
						
				</table>
				
				
			</div>
		
		<div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
			<ul class="mui-table-view">
				
				<li class="mui-table-view-cell" id="custView2">
					<a href="#" id="custView">关联至客户视图</a>
				</li>
				
				<li class="mui-table-view-cell" id="custComment">
					<a href="#">备注</a>
				</li>
				<li class="mui-table-view-cell">
					<a href="#">联系记录</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#picture"><b>取消</b></a>
				</li>
			</ul>
		</div>
			
		
		
			<div class="mui-media-body" style="overflow:scroll">
				<!-- 联系电话	客户名	客户编号	地址	套餐名称	到期时间	业务分类	终端类型	套餐类型 -->

				<table id="marketingDetailTable">
					<tr>
						<th>联系电话</th>
						<th>客户名</th>
						<th>客户编号</th>
						<th>地址</th>
						<th>套餐名称</th>
						<th>终端类型</th>
						<th>套餐类型</th>
					<tr>
				<table>
			</div>
			

		
		
		


		</div>
  </body>
    <script src="[!JS]zsyx/jquery-2.1.4.js?v={$version}"></script>	
	<SCRIPT src="[!JS]zsyx/qzgdwlSearch.js?v={$version}" type="text/JavaScript" > </SCRIPT>
	<SCRIPT src="[!JS]zsyx/function.js?v={$version}" type="text/JavaScript"></SCRIPT>
	<script src="[!JS]zsyx/mui.min.js?v={$version}"></script>
	<script src="[!JS]zsyx/echarts-all.js?v={$version}"></script>
	<script src="[!JS]zsyx/agentJS/layer.m.js"></script>
	<script src="[!JS]common.function.js"></script>
   <script type="text/JavaScript">
		mui.init({
			swipeBack:false //启用右滑关闭功能
		});
		var info = document.getElementById("info");
		//document.querySelector('#condSel').addEventListener('click',function(e){
		//	//1、获取选中哪个单选框
		//	var checkedValue= getVals();
		//	mui.alert(checkedValue);
		//	//2、清空表格
		//	$("#marketingDetailTable  tr:not(:first)").empty("");
		//	
		//	//3、重新获取数据
		//	
		//});
		
		$('#doSearch').on('tap',function(){
				//1 获取下拉框的值
　　			var $opt = $("#selectList").children('option:selected');
				var staff = $($opt).val();
				//mui.alert(ifdq);
				
				//2 获取选中哪个单选框
				var busi_type = getRadioRes('radioOffer');
				//mui.alert(busi_type);
				
				
				//获取数据
				refreshData(busi_type,staff);
		});
			
			
		
		//默认取今日到期数据
		$(document).ready(function() { 
			refreshData('2','0');
		});
	
	
	function refreshData(busi_type,staff){
		var delay=layer.open({type:2,shadeClose:false});
		$("#marketingDetailTable  tr:not(:first)").empty("");
		var paraStr="busi_type="+busi_type;
		paraStr += "&staff="+staff;
		
		$.ajax({
				type:'post',
				  url: "index.php?m=zsyx&a=queryMarketingZZZYDetail",
				  context: document.body,
				  dataType:'json',  
				  data:paraStr,
				  success: function(json){
					var obj = eval(json.zz_info);
					if(typeof(obj) != "undefined"){
						for(var i=0; i<obj.length; i++)  
					    {  	//联系电话	客户名	客户编号	地址	套餐名称	到期时间	业务分类	终端类型	套餐类型
							var phoneStr = (obj[i].phone).replace(/,/g," ");
							var phoneArray = phoneStr.split(" ");
							var phone="";
							for (var k=0;k<phoneArray.length;k++)
							{
								var tmpStr = '<a href="tel:'+phoneArray[k]+'">'+phoneArray[k]+'&nbsp'+'</a>';
								phone = phone + tmpStr;
							}
					    	$("#marketingDetailTable").append('<tr>'+
							'<td>' + phone + '</td>'  + 
					    	'<td>' + obj[i].acct_name + '</td>'  + 
							'<td><a href="#picture" class="mui-btn mui-btn-primary mui-btn-block mui-btn-outlined" style="padding: 5px 20px;">' + obj[i].acct_code +'</a></td>'+
					    	 
					    	'<td>' + obj[i].address + '</td>'  + 
					    	'<td>' + obj[i].offer_name + '</td>'  + 
					    	'<td>' + obj[i].subtype_name + '</td>'  + 
					    	'<td>' + obj[i].offer_type + '</td>'  + 						
					    	'</tr>' );
					    }
					}
					layer.close(delay);	 
					watermark('{$company}{$boss_name}');					
					
				  }
			});	
			
	}

    function getRadioRes(className){
        var rdsObj = document.getElementsByName(className);
        var checkVal = null;
        for(i = 0; i < rdsObj.length; i++){
            if(rdsObj[i].checked){checkVal = rdsObj[i].value;}
        }
        return checkVal;
    }
	
	window.cust_code = ""; 
	window.cust_name = ""; 
	mui('body').on('tap', 'td>a', function() {
	
			var a = this;
			cust_code = a.innerText;
			
			var column=parseInt($(this).parents('td').index())+parseInt(1);			 
            var row = parseInt($(this).parents('tr').index()+1);
			
			cust_name=$("#marketingDetailTable").find("tr").eq(row-1).find("td").eq(column-2).text();
	});
	
	
	mui('#custView2').on('tap', 'a', function() {
			var url="index.php?m=ywy&a=ywyIndex&cust_code="+cust_code;
			window.location.href=url; 
	});
	
	mui('#custComment').on('tap', 'a', function() {
			var url="index.php?m=zsyx&a=zsyxCustComment&cust_code="+cust_code+"&cust_name="+cust_name;
			window.location.href=url; 
	});
	
	//js获取复选框的值
	//function getVals(){
    //    var res = getCheckBoxRes('rds');
    //    if(res.length < 1){
    //        mui.toast('请选择');
    //        return;
    //    }
    //    mui.toast(res);
    //}
    //function getCheckBoxRes(className){
    //    var rdsObj   = document.getElementsByClassName(className);
    //    var checkVal = new Array();
    //    var k        = 0;
    //    for(i = 0; i < rdsObj.length; i++){
    //        if(rdsObj[i].checked){
    //            checkVal[k] = rdsObj[i].value;
    //            k++;
    //        }
    //    }
    //    return checkVal;
    //}

    </script>
	
	
</html>


